<?xml version="1.0" encoding="UTF-8"?>
<!-- You may freely edit this file. See harness/README in the NetBeans platform -->
<!-- for some information on what you could do (e.g. targets to override). -->
<!-- If you delete this file and reopen the project it will be recreated. -->
<project name="bluej-suite" basedir=".">
    <description>Builds the module suite bluej-suite.</description>
    <import file="nbproject/build-impl.xml"/>
    <loadproperties srcfile="external-references.properties"/>
    <!-- custom build target -->
    <target name="build" depends="suite.build">
        <!-- this was necessary only because the three projects were not registered in project.xml of this suite
        <ant antfile="bluej/build.xml" target="netbeans" inheritAll="false"/>
        <ant antfile="bluej-ui/build.xml" target="netbeans" inheritAll="false"/>
        <ant antfile="bluej-welcome/build.xml" target="netbeans" inheritAll="false"/>
        -->
        <!--copy todir="${cluster}">
            <fileset dir="${platform.location}/extra">
                <include name="**/*bluej*"/>
            </fileset>
        </copy-->
        <!--delete dir="${platform.location}/extra"/-->
        <copy todir="${cluster}">
            <fileset dir="changing-defaults"/>
        </copy>
        <copy todir="${cluster}/etc">
            <fileset dir="launcher">
                <include name="nbbluej.clusters"/>
                <include name="nbbluej.conf"/>
            </fileset>
        </copy>
        <copy todir="${cluster}/lib">
            <fileset dir="launcher/unix">
                <include name="nbbluej"/>
                <include name="windows/nbbluej.exe"/>
                <include name="windows/nbbluej_w.exe"/>
            </fileset>
            <fileset dir="launcher/windows">
                <include name="nbbluej.exe"/>
                <include name="nbbluej_w.exe"/>
            </fileset>
        </copy>
        <copy todir="${cluster}">
            <fileset dir="${platform.location}/${bluej_nb_cluster}">
                <include name="**/*applemenu*"/>
            </fileset>
        </copy>
        <copy todir="${cluster}">
            <fileset dir="${platform.location}/${bluej_nb_cluster}">
                <include name="shortcuts.pdf"/>
            </fileset>
        </copy>
        <copy todir="${cluster}">
            <fileset dir="branding/release">
                <include name="**/*.txt"/>
                <include name="**/*.html"/>
                <include name="**/*.properties"/>
            </fileset>
        </copy>
    </target>

    <!-- custom clean target -->
    <!-- this was necessary only because the three projects were not registered in project.xml of this suite
    <target name="clean" depends="suite.clean">
    <ant antfile="bluej/build.xml" target="clean" inheritAll="false"/>
    <ant antfile="bluej-ui/build.xml" target="clean" inheritAll="false"/>
    <ant antfile="bluej-welcome/build.xml" target="clean" inheritAll="false"/>
    </target>
    -->
    
    <!-- custom run target -->
    <!-- this custom run.xml is needed because we need to put our cluster as the first one in the list of clusters
    it is the only change in the run.xml file we have, see the comment line in this run.xml -->
    <target name="run" depends="build">
        <ant antfile="run.xml" target="run"/>
    </target>

    <!-- custom build-zip target -->
    <target name="build-zip" depends="build">
        <mkdir dir="dist"/>
        <zip destfile="dist/${app.name}.zip">
            <zipfileset dir="${cluster}" prefix="${bluej_cluster}">
                <exclude name="**/lib/nbbluej"/>
            </zipfileset>
            <zipfileset dir="${cluster}" filemode="755" prefix="${bluej_cluster}">
                <include name="**/lib/nbbluej"/>
            </zipfileset>
        </zip>
        <chmod perm="755">
            <fileset dir="${cluster}">
                <include name="**/lib/nbbluej"/>
            </fileset>
        </chmod>
    </target>
    
    <target name="l10n-kit">
        <taskdef name="l10n" classname="org.netbeans.nbbuild.L10nTask"
            classpath="${nb_all_2_level}/nbbuild/nbantext.jar"/>
        <mkdir dir="dist"/>
        <delete dir="build/l10n"/>
        <mkdir dir="build/l10n"/>
        <property name="nbroot" location="../../ide"/>
        <l10n topdirs="${nb_all_2_level}" modules="ide,installer"
            localizablefile="bluejl10n.list" generatedfile="bluejl10n.list.translated"
            distdir="dist" changedfile="bluejl10n.list.changed"
            builddir="build/l10n" buildnumber="${buildnumber}"
            excludepattern="**/ja/,**/*_ja.*"/>
    </target>    
    
    <target name="installers">
        <ant dir="${nb.all}/java/storagebuilder" inheritAll="false"/>
        <property environment="myenv"/>
        <echo>Installer intallation dir is: ${myenv.ISMP}</echo>
        <!-- installers for NB 5 -->
        <ant antfile="${nb.all}/installer/coreidebluej/build.xml" target="build" inheritAll="false">
            <property name="nbbluej.dir" location="build"/>
            <property name="ismp.home" location="${myenv.ISMP}"/>
            <property name="installer.basename" value="NetBeansBlueJ-6.0"/>
        </ant>        
        <ant antfile="${nb.all}/installer/macbluej/build.xml" target="tarball" inheritAll="false">
            <property name="nbbluej.dir" location="build"/>
            <property name="ismp.home" location="${myenv.ISMP}"/>
            <property name="tarball-name" value="NetBeansBlueJ-6.0-macos.tar.gz"/>
        </ant>        
    </target>

    <target name="ml-build" depends="-init">
        <taskdef name="locjhindexer" classname="org.netbeans.nbbuild.LocJHIndexer"
            classpath="${nb.all}/nbbuild/nbantext.jar"/>
        <taskdef name="locjar" classname="org.netbeans.nbbuild.LocalizedJar"
            classpath="${nb.all}/nbbuild/nbantext.jar"/>    
        <property name="locjhindexer.jhall" value="${nb.all}/nbbuild/external/jhall*.jar"/>
        <property name="locjar.warnMissingDir" value="true"/>
        <property name="locales" value="ru,fr,nl,ja,zh_CN,zh_TW,es,sq_AL"/>
        <property name="locjar.locales"       value="${locales}"/>
        <property name="locjar.brands"        value="nbbluej"/>
        <property name="locjhindexer.locales" value="${locales}"/>
        <locjar basedir="${nb.all}/translatedfiles/src/ide/bluej-suite/branding/core/core.jar"
            jarfile="build/${bluej_cluster}/core/core.jar"/>

        <locjar basedir="${nb.all}/translatedfiles/src/ide/bluej-suite/branding/modules/org-apache-tools-ant-module.jar"
            jarfile="build/${bluej_cluster}/modules/org-apache-tools-ant-module.jar"/>
        <locjar basedir="${nb.all}/translatedfiles/src/ide/bluej-suite/branding/modules/org-netbeans-core-windows.jar"
            jarfile="build/${bluej_cluster}/modules/org-netbeans-core-windows.jar"/>
        <locjar basedir="${nb.all}/translatedfiles/src/ide/bluej-suite/branding/modules/org-netbeans-core.jar"
            jarfile="build/${bluej_cluster}/modules/org-netbeans-core.jar"/>
        <locjar basedir="${nb.all}/translatedfiles/src/ide/bluej-suite/branding/modules/org-netbeans-modules-utilities.jar"
            jarfile="build/${bluej_cluster}/modules/org-netbeans-modules-utilities.jar"/>
            
            
        <locjar basedir="${nb.all}/translatedfiles/src/ide/bluej-ui/src"
            jarfile="build/${bluej_cluster}/modules/org-netbeans-bluej-ui.jar"/>
        <locjar basedir="${nb.all}/translatedfiles/src/ide/projectimport/bluej/src"
            jarfile="build/${bluej_cluster}/modules/org-netbeans-bluej.jar"/>
        <locjar basedir="${nb.all}/translatedfiles/src/ide/bluej-suite/bluej-welcome/src"
            jarfile="build/${bluej_cluster}/modules/org-netbeans-bluej-welcome.jar"/>            
        <locjar basedir="${nb.all}/translatedfiles/src/ide/bluej-suite/bluej-upgrade/src"
            jarfile="build/${bluej_cluster}/core/org-netbeans-bluej-upgrader.jar"/>            
            
        <locjhindexer basedir="${nb.all}/translatedfiles/src/ide/projectimport/bluej/javahelp/org/netbeans/bluej/docs"
            dbdir="JavaHelpSearch"/>
            
        <locjar basedir="${nb.all}/translatedfiles/src/ide/projectimport/bluej/javahelp"
            jarfile="build/${bluej_cluster}/modules/docs/org-netbeans-bluej.jar"/>
            
        <copy todir="${cluster}">
            <fileset dir="${nb.all}/nbbuild/ml/netbeans/${bluej_nb_cluster}">
                <include name="**/*applemenu*"/>
            </fileset>
        </copy>            
        <copy todir="${cluster}">
            <fileset dir="${nb.all}/nbbuild/ml/netbeans/${bluej_nb_cluster}">
                <include name="shortcuts*.pdf"/>
            </fileset>
        </copy>            
        <copy todir="${cluster}">
            <fileset dir="${nb.all}/translatedfiles/src/ide/bluej-suite/branding/release">
                <include name="**/*.txt"/>
                <include name="**/*.html"/>
                <include name="**/*.properties"/>
            </fileset>
        </copy>

        <copy todir="${nb.all}/installer">
            <fileset dir="${nb.all}/translatedfiles/src/installer"/>
        </copy>

        <property environment="myenv"/>
        <echo>Installer intallation dir is: ${myenv.ISMP}</echo>
        <!-- installers for NB 5 -->
        <ant antfile="${nb.all}/installer/coreidebluej/build.xml" target="build-ml" inheritAll="false">
            <property name="nbbluej.dir" location="build"/>
            <property name="ismp.home" location="${myenv.ISMP}"/>
            <property name="nb.dir" location="${nb.all}/nbbuild/ml/netbeans"/>
            <property name="installer.basename" value="NetBeansBlueJ-6.0"/>
        </ant>        
        <ant antfile="${nb.all}/installer/macbluej/build.xml" target="tarball" inheritAll="false">
            <property name="nbbluej.dir" location="build"/>
            <property name="ismp.home" location="${myenv.ISMP}"/>
            <property name="nb.dir" location="${nb.all}/nbbuild/ml/netbeans"/>
            <property name="tarball-name" value="NetBeansBlueJ-6.0-macos-ml.tar.gz"/>
        </ant>        
    </target>
    
    <target name="all" depends="build-zip,l10n-kit,installers,ml-build"/>
</project>
