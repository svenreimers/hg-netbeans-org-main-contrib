<?xml version="1.0"?>

<!-- Sample Ant script to create a NetBeans module and test it. -->

<project name="pmd-nb-ext" basedir="." default="all">

<!--  <property name="nb_root" location="/opt/devel/nbtrunk/nb_all"/>-->
  <property name="nb_root" location="C:/devel/trunk"/>
  <property name="pmdroot" location="../pmd-netbeans-0.5"/>
  <path id="pmdpath">
    <pathelement location="${pmdroot}/lib/pmd-1.01.jar"/>
  </path>

      <target name="compile">
        <javac srcdir="src" destdir="classes" 
               deprecation="${build.compiler.deprecation}" 
               debug="${build.compiler.debug}">
            <classpath>
                <pathelement location="${nb_root}/openide/openide-13javac-workaround.jar"/>
                <fileset dir="${nb_root}/openide/netbeans/lib">
                  <include name="openide*.jar" />
                </fileset>
                <path refid="pmdpath"/>
            </classpath>
        </javac>
    </target>

    <target name="jars" depends="compile">
        <mkdir dir="netbeans/modules"/>
        <jar jarfile="netbeans/modules/pmd-nb.jar" manifest="manifest.mf" compress="false">
            <fileset dir="classes">
            </fileset>
            <fileset dir="src">
                <include name="**/*.xml"/>
                <include name="**/*.properties"/>
                <include name="**/*.gif"/>
            </fileset>
        </jar>
    </target>

  <target name="all" depends="jars" description="Build the module.">
    <taskdef name="genlist" classname="org.netbeans.nbbuild.MakeListOfNBM" classpath="${nb_root}/nbbuild/nbantext.jar"/>
    <genlist targetname="nbm" outputfiledir="netbeans"/>
  </target>

  <target name="nbm" depends="all" description="Prepare the module for distribution via Auto Update.">
    <taskdef classname="org.netbeans.nbbuild.MakeNBM" classpath="${nb_root}/nbbuild/nbantext.jar" name="makenbm"/>
    <delete dir="Info"/>
    <makenbm file="pmd-nb.nbm"
             topdir="."
             module="netbeans/modules/pmd-nb.jar"
	     homepage="http://www.netbeans.org/">
      <license file="${nb_root}/nbbuild/standard-nbm-license.txt"/>
      <!--<signature keystore="${keystore}" storepass="${storepass}" alias="${nbm_alias}"/>-->
    </makenbm>
  </target>

    <!-- This target will only work *inside* the IDE! -->
    <target name="test" depends="compile" description="Test the module inside the running IDE.">
        <!-- Use a separate directory, since the IDE will create junk files like test/mymodule12345-test.jar: -->
        <mkdir dir="test"/>
        <jar jarfile="test/pmd-nb.jar" manifest="manifest.mf" compress="false">
            <fileset dir="classes">
            </fileset>
            <fileset dir="src">
                <include name="**/*.xml"/>
                <include name="**/*.properties"/>
                <include name="**/*.gif"/>
            </fileset>
        </jar>
        <nbinstaller module="test/pmd-nb.jar" action="reinstall"/>
    </target>


    <target name="clean" description="Clean all build products.">
        <delete>
            <fileset dir="classes">
                <!--<include name="**/*.class"/>-->
            </fileset>
        </delete>
        <delete file="pmd-nb.nbm"/>
        <delete dir="netbeans"/>
        <delete dir="Info"/>
        <delete dir="test"/>
    </target>

</project>
