/*
 * The contents of this file are subject to the terms of the Common Development
 * and Distribution License (the License). You may not use this file except in
 * compliance with the License.
 *
 * You can obtain a copy of the License at http://www.netbeans.org/cddl.html
 * or http://www.netbeans.org/cddl.txt.
 *
 * When distributing Covered Code, include this CDDL Header Notice in each file
 * and include the License file at http://www.netbeans.org/cddl.txt.
 * If applicable, add the following below the CDDL Header, with the fields
 * enclosed by brackets [] replaced by your own identifying information:
 * "Portions Copyrighted [year] [name of copyright owner]"
 *
 * The Original Software is NetBeans. The Initial Developer of the Original
 * Software is Sun Microsystems, Inc. Portions Copyright 1997-2006 Sun
 * Microsystems, Inc. All Rights Reserved.
 */

package org.netbeans.modules.helpbuilder.ui;

import java.awt.BorderLayout;
import java.awt.Component;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.net.URL;
import java.net.MalformedURLException;
import java.util.HashSet;
import java.util.Iterator;
import java.util.Set;
import javax.help.HelpSet;
import javax.help.JHelp;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;
import org.netbeans.modules.helpbuilder.HelpPreview;
import org.netbeans.modules.helpbuilder.processors.HelpSetProcessor;
import org.netbeans.modules.helpbuilder.processors.MapProcessor;
import org.netbeans.modules.helpbuilder.tree.HelpTreeNode;
import org.openide.ErrorManager;
import org.openide.util.Lookup;

import org.openide.util.NbBundle;

/** A single panel for a wizard.
 * You probably want to make a wizard iterator to hold it.
 *
 * @author  Richard Gregor
 */
public class HelpPreviewPanel extends javax.swing.JPanel {
    private  HelpSet hs;
    private  JHelp help;
    private  ClassLoader loader;
    private  String helpsetPath;
    private JPanel helpPanel;
    private final HelpPreview descriptor; 

    /** Create the wizard panel and set up some basic properties. */
    public HelpPreviewPanel(HelpPreview descriptor) {
        this.descriptor = descriptor;                
        try{
            loader = this.getClass().getClassLoader();            
            URL hsURL = new URL("file:"+getHelpsetPath());
            hs = new HelpSet(loader,hsURL);
        }
        catch(Exception ee){
            ErrorManager.getDefault().notify(ee);        
        }
        
        helpPanel = new JPanel();
        helpPanel.setBorder(new javax.swing.border.SoftBevelBorder(javax.swing.border.BevelBorder.RAISED));        
        help = new JHelp(hs);  
        initComponents ();        
        add(help, java.awt.BorderLayout.CENTER);
        
        // Provide a name in the title bar.
        setName(NbBundle.getMessage(ProjectFinishPanel.class, "TITLE_HelpPreviewPanel"));
        
    }
    
    /**
     * Recreates help object
     * Called from wizarddescriptor's method read settings
     */
    public void recreate(){
        System.err.println("recreate");
        try{
            loader = this.getClass().getClassLoader();
            //URL hsURL = HelpSet.findHelpSet(loader,getHelpsetPath());
            URL hsURL = new URL("file:"+getHelpsetPath());
            hs = new HelpSet(loader,hsURL);
        }
        catch(Exception ee){
            ErrorManager.getDefault().notify(ee);        
        }
        
        help = new JHelp(hs);                
        removeAll();
        add(help, java.awt.BorderLayout.CENTER);
       // add(new JLabel("ahoj"),BorderLayout.NORTH);
        repaint();
    }
    
     
    public boolean isValid(){
        return true;
    }
    
    
    private static String getHelpsetPath(){
        return ProjectSetupPanel.getTargetLocation()+File.separator+"HelpSet.hs";
    }
    
   
    // --- VISUAL DESIGN OF PANEL ---

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        java.awt.GridBagConstraints gridBagConstraints;

        setLayout(new java.awt.BorderLayout(10, 10));

        setBorder(new javax.swing.border.EtchedBorder());
    }//GEN-END:initComponents

    // Variables declaration - do not modify//GEN-BEGIN:variables
    // End of variables declaration//GEN-END:variables


}
