<!--
                Sun Public License Notice

The contents of this file are subject to the Sun Public License
Version 1.0 (the "License"). You may not use this file except in
compliance with the License. A copy of the License is available at
http://www.sun.com/

The Original Code is NetBeans. The Initial Developer of the Original
Code is Sun Microsystems, Inc. Portions Copyright 1997-2001 Sun
Microsystems, Inc. All Rights Reserved.
-->

<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="lastupdated" content="29aug2000">
   <meta name="GENERATOR" content="Mozilla/4.6 [en] (WinNT; U) [Netscape]">
   <title>Completing Client-side Files</title>
<!--       
 *        Copyright (C) 2000  Sun Microsystems, Inc
 *                    All rights reserved.
 *          Notice of copyright on this source code 
 *          product does not indicate publication. 
 * 
 * RESTRICTED RIGHTS LEGEND: Use, duplication, or disclosure by 
 * the U.S. Government is subject to restrictions as set forth 
 * in subparagraph (c)(1)(ii) of the Rights in Technical Data
 * and Computer Software Clause at DFARS 252.227-7013 (Oct. 1988) 
 * and FAR 52.227-19 (c) (June 1988).
 *
 *    Sun Microsystems, Inc., 901 San Antonio Road,
 *    Palo Alto, California 94303 U.S.A.
 *
-->
</head>
<body bgcolor="#FFFFFF">

<h2>
Completing Client-side Files</h2>
The code you add to your client program depends on the binding method the
program uses:
<ul>
<li>
If your client reads an IOR from standard input, the binding code is complete,
and you can code the narrow() operation and invocations of server-side
methods.</li>

<li>
If your client reads an IOR from a file, you need to add the file's name.
After doing this you can code the narrow() operation and server-side method
invocations.</li>

<li>
If your client reads an IOR from a Naming Service, you need to code a naming
service <tt>resolve()</tt> operation. After doing this you can code the
<tt>narrow()</tt>
operation and invocations of server-side methods.</li>
</ul>

<h4>
<a NAME="existing"></a>Coding the Naming Service resolve()</h4>
If your client class uses Naming Service Binding, the generated code does
not include the lookup() operation. In order to code this you need to know
how the server binds itself to the naming service. The easiest way to generate
this code is with the Naming Service Browser, which can read the server's
IOR from the naming service and generate lookup code for you.
<ol>
<li>
Start&nbsp; the CORBA server program.</li>

<li>
Point the CORBA Module's Naming Service Browser to the naming service to
which the server program bound the servant instance it created.</li>

<li>
Expand the Naming Service node to the subnode that represents the servant
instance.</li>

<li>
Right-click&nbsp; the node that represents the servant instance. From the
context menu choose Copy Client Code.</li>

<li>
Switch to the editing window (Your client class should be open in the editing
window.)</li>

<li>
Locate the following comment in the generated code:</li>

<ol><tt>// paste here code from Copy Client Code on Object Node in NamingService
Browser</tt></ol>

<li>
Put your cursor underneath this line and press CTRL-V. This pastes the
code that was generated by the Naming Service Browser, which will look
something like this</li>

<ol><tt>String[] client_name_hierarchy = new String [] {"Forte4J", "Demo",
"HelloWorldImpl", "Demo"};</tt></ol>
</ol>

<h4>
<a NAME="new"></a>Coding the narrow() and Invoking Server-side Methods</h4>
Whichever binding method your client uses, the result is an object of type
org.omg.CORBA.Object, named <tt>obj</tt>, which represents the IOR. For
example, clients that read an IOR from a file will contain this code:
<blockquote><tt>org.omg.CORBA.Object obj = null;</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FileReader
file = new java.io.FileReader("&lt;file_name>");</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
BufferedReader input = new java.io.BufferedReader(file);</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
String target = input.readLine();</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
input.close();</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
obj = orb.string_to_object(target);</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
...</tt></blockquote>
In clients that use naming service binding, the IOR is obtained by the
<tt>resolve()</tt>
operation. For example:
<ol><tt>org.omg.CORBA.Object obj = null;</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
//</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// Resolve names with the Naming Service</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
//</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// paste here code from Copy Client Code on Object Node in Naming Service
Browser</tt>
<ol><tt>&nbsp; String[] client_name_hierarchy = new String [] {"Forte4J",
"Demo", "HelloWorldImpl", "Demo"};</tt></ol>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
NameComponent[] aName = new NameComponent[client_name_hierarchy.length
/ 2];</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
for (int i=0; i&lt;(client_name_hierarchy.length / 2); i++) {</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
aName[i] = new NameComponent();</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
aName[i].id = client_name_hierarchy[i*2];</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
aName[i].kind = client_name_hierarchy[i*2+1];</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
}</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
obj = nc.resolve (aName);</tt></ol>
To use the IOR, you need to perform a <tt>narrow() </tt>operation, which
returns a proxy for the server-side object.
<ol>
<li>
In your generated client file, look for this comment:</li>

<ol><tt>// Place narrowing of your object here.</tt>
<br><tt>// Something like:&nbsp; &lt;interface> &lt;name> = &lt;class>Helper.narrow
(obj);</tt></ol>

<li>
Replace it with code that creates a client-side proxy for the servant instance.
For example:</li>

<ol><tt>Hello helloProxy = helloHelper.narrow (obj);</tt></ol>

<li>
Add code that invokes server-side methods on the proxy object. For example:</li>

<ol><tt>System.out.println (helloProxy.sayHello(3));</tt></ol>
</ol>
The first line creates the proxy. <tt>Hello</tt> is a Java interface that
was generated from the <tt>Hello</tt> interface in IDL; it is used here
as a Java datatype. <tt>obj</tt>, the object that was returned from the
naming service, is narrowed (cast) to a <tt>Hello</tt> type. The second
line uses the proxy to invoke the <tt>sayHello()</tt> method.
<h4>
Compiling Your Client</h4>
The last step is to compile all of the classes related to the client, including
the IDL file, together. Right-click on the node for the package and select
Compile from the contextual menu.
<br>
<hr><font size=-2><a href="../credits.html">Legal Notices</a></font>
</body>
</html>
