<?xml version="1.0" encoding="UTF-8"?>
<!--
                Sun Public License Notice

The contents of this file are subject to the Sun Public License
Version 1.0 (the "License"). You may not use this file except in
compliance with the License. A copy of the License is available at
http://www.sun.com/

The Original Code is NetBeans. The Initial Developer of the Original
Code is Sun Microsystems, Inc. Portions Copyright 1997-2002 Sun
Microsystems, Inc. All Rights Reserved.
-->

<project name="tasklist/api" default="netbeans" basedir=".">

    <property name="nb_all" value="../.."/>

    <taskdef name="makenbm" classname="org.netbeans.nbbuild.MakeNBM" classpath="${nb_all}/nbbuild/nbantext.jar"/>
    <taskdef name="genlist" classname="org.netbeans.nbbuild.MakeListOfNBM" classpath="${nb_all}/nbbuild/nbantext.jar"/>
    <taskdef name="locjar" classname="org.netbeans.nbbuild.LocalizedJar" classpath="${nb_all}/nbbuild/nbantext.jar"/>
  <taskdef name="checklinks" classname="org.netbeans.nbbuild.CheckLinks">
    <classpath>
      <pathelement location="../../nbbuild/nbantext.jar"/>
      <fileset dir="../../core/external">
        <include name="regexp*.jar"/>
      </fileset>
    </classpath>
  </taskdef>

    <property name="nbm_alias" value="nb_ide"/>
    <property name="homepage.base" value="netbeans.org"/>
    <property name="dist.base" value="www.netbeans.org/download/nbms/40"/>
    <property name="license.file" value="${nb_all}/nbbuild/standard-nbm-license.txt"/>
  
    <target name="compile">
        <javac srcdir="src" destdir="src" deprecation="${build.compiler.deprecation}" debug="${build.compiler.debug}">
            <classpath>
                <pathelement location="${nb_all}/openide/openide-13javac-workaround.jar"/>
                <fileset dir="${nb_all}/openide/netbeans/lib">
                    <include name="openide*.jar" />
                </fileset>
            </classpath>
        </javac>
    </target>

    <target name="jars" depends="compile">
        <mkdir dir="netbeans/modules/autoload"/>
        <filter token="BUILD_NUMBER_SUBST" value="${buildnumber}"/>
        <copy file="manifest.mf" tofile="manifest-subst.mf" filtering="on"/>
        <locjar jarfile="netbeans/modules/autoload/tasklist-api.jar"
                manifest="manifest-subst.mf"
                basedir="src"
	        excludesfile="${nb_all}/nbbuild/standard-jar-excludes.txt"
	        compress="false">
            <locale name="ja"/>
        </locjar>
    </target>

    <target name="netbeans" depends="jars">
        <genlist targetname="nbm" outputfiledir="netbeans"/>
    </target>

    <target name="nbm" depends="netbeans">
        <makenbm file="../tasklist-api.nbm"
                 topdir="."
                 module="netbeans/modules/autoload/tasklist-api.jar"
                 homepage="http://tasklist.${homepage.base}/"
                 distribution="http://${dist.base}/tasklist-api.nbm"
                 needsrestart="false">
            <license file="${license.file}"/>
            <signature keystore="${keystore}" storepass="${storepass}" alias="${nbm_alias}"/>
        </makenbm>
    </target>
  
    <target name="clean">
        <delete>
            <fileset dir="." includes="**/*.class"/>
        </delete>
        <delete file="manifest-subst.mf"/>
        <delete file="../tasklist-api.nbm"/>
        <delete dir="netbeans"/>
        <delete dir="Info"/>
        <delete dir="javadoc"/>
        <delete dir="TasklistAPI"/>
        <delete file="TasklistAPI.zip"/>
    </target>


 <target name="javadoc" depends="tasklist-apis">
    <copy todir="javadoc">
      <fileset dir=".">
        <include name="TasklistAPI/**"/>
        <include name="TasklistAPI.zip"/>
      </fileset>
    </copy>
  </target>

  <target name="tasklist-apis" description="Create Tasklist API documentation.">
   <delete dir="TasklistAPI"/>
   <mkdir dir="TasklistAPI"/>
   <property name="jdk-docs-location" value="http://java.sun.com/j2se/1.4/docs/api"/>

    <tstamp/>
    <property name="tasklist-apis-header"
              value="&lt;font color=red&gt;This is a preliminary version of APIs.&lt;br&gt;Listed APIs are subject to change.&lt;/font&gt;"/>
    <property name="tasklist-apis-footer"
              value="&lt;font size=-2 color=gray&gt;Built on ${TODAY}.&amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp;Portions Copyright 1997-2003 Sun Microsystems, Inc. All rights reserved.&lt;/font&gt;"/>

    <echo message="Build Tasklist API documentation..."/>

    <mkdir dir="javadoc"/>

    <javadoc destdir="TasklistAPI"
             packagenames="org.netbeans.api.tasklist.*,org.netbeans.spi.tasklist.*"
             doctitle="NetBeans Tasklist APIs"
             windowtitle="Tasklist APIs"
             overview="doc/overview.html"
             header="@@HEADER@"
             bottom="${tasklist-apis-footer}"
             use="true"
             splitindex="true"
             author="false"
             version="false"
             maxmemory="64m"
             stylesheetfile="../../openide/api/doc/javadoc.css"
    >
      <sourcepath>
        <pathelement location="doc"/>
        <pathelement location="src"/>
      </sourcepath>

      <classpath>
	<pathelement location="../../openide/openide-13javac-workaround.jar"/>
        <fileset dir="../../openide/netbeans/lib">
          <include name="openide*.jar" />
        </fileset>
        <pathelement location="../../core/netbeans/lib/core.jar"/>
        <fileset dir="../../core/external">
          <include name="xml-apis*.jar" />
        </fileset>
      </classpath>

      <link href="${jdk-docs-location}"
            offline="true"
            packagelistLoc="../../openide/api/doc"
      />
      <link href="../../OpenAPIs"
	    offline="true"
	    packagelistLoc="../../openide/OpenAPIs"
      />
    </javadoc>

    <!-- copy stylesheet -->
    <copy file="../../openide/api/doc/open-apis.css" tofile="TasklistAPI/open-apis.css"/>
    <copy file="../../openide/api/doc/nb-docs.css" tofile="TasklistAPI/nb-docs.css"/>

    <!-- replace tokens -->
    <replace dir="TasklistAPI" token="@JDK@" value="${jdk-docs-location}">
      <include name="**/doc-files/*.html"/>
      <include name="**/package-summary.html"/>
    </replace>
    <replace dir="TasklistAPI" token="@HEADER@" value="${tasklist-apis-header}">
      <include name="**/*.html"/>
      <exclude name="overview-frame.html"/>
    </replace>
    <replace dir="TasklistAPI" token="@HEADER@" value="">
      <include name="overview-frame.html"/>
    </replace>
    <replace dir="TasklistAPI" token="@FOOTER@" value="${tasklist-apis-footer}">
      <include name="**/doc-files/*.html"/>
    </replace>
    <replace file="TasklistAPI/overview-summary.html" token="@DATE@" value="${TODAY}"/>

    <!-- reference to local copy of OpenAPIs javadoc (should work also on website) -->
<!--
    <replace dir="TasklistAPI" token="@OPENAPI@" value="../../OpenAPIs">
      <include name="**/*.html"/>
    </replace>
-->

    <!-- [PENDING] fuller check mode too, checking on-line links and more HTML files? -->

    <checklinks basedir="TasklistAPI" checkexternal="false">
      <include name="overview-summary.html"/>
      <include name="**/package-summary.html"/>
      <include name="**/doc-files/**/*.html"/>
      <include name="**/package.html"/>
    </checklinks>

    <zip zipfile="TasklistAPI.zip" basedir="TasklistAPI"/>
  </target>

    <target name="release">
    </target>

    <target name="javahelp">
    </target>

  
</project>
